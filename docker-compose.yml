version: "3.8"

services:
  mailbox-api:
    build: .
    container_name: mailbox-api
    restart: unless-stopped
    ports:
      - "3100:3100"
    environment:
      - PORT=3100
      - PGHOST=${PGHOST}
      - PGPORT=${PGPORT:-5432}
      - PGUSER=${PGUSER}
      - PGPASSWORD=${PGPASSWORD}
      - PGDATABASE_TEAM=${PGDATABASE_TEAM}
      - MAILBOX_TOKEN_DOMINGO=${MAILBOX_TOKEN_DOMINGO}
      - MAILBOX_TOKEN_CLIO=${MAILBOX_TOKEN_CLIO}
      - MAILBOX_TOKEN_ZUMIE=${MAILBOX_TOKEN_ZUMIE}
      - MAILBOX_TOKEN_CHRIS=${MAILBOX_TOKEN_CHRIS}
      - MAILBOX_ADMIN_TOKEN=${MAILBOX_ADMIN_TOKEN}
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3100/healthz"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 5s
    networks:
      - internal

networks:
  internal:
    external: true
